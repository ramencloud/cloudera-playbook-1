{
  "cdhVersion" : "{{ cdh_version }}",
  "displayName" : "{{ cluster_display_name }}",
  "cmVersion" : "{{ scm_version }}",
  "products" : [
    {% set prod_j = joiner(",") %}
    {% for product in scm_products %}
    {{ prod_j() }}
    {
      "version" : "{{ product['version'] }}",
      "product" : "{{ product['product'] }}"
    }
    {% endfor %}
  ],
  "services" : [
    {% set serv_j = joiner(",") %}
    {% for service in (cdh_services|selectattr('type', 'in', cdh_service_types | default(cdh_services | map(attribute='type'))))  %}
    {{ serv_j() }}
    {% if service['type'] + '_def_override' in vars %}
        {{ lookup('vars', service['type'] + '_def_override') | to_nice_json }}
    {% else %}
        {% set t = service['type'] + '.j2' %}
        {% include t %}
    {% endif %}
    {% endfor %}
  ],
  "hostTemplates" : {% if hosts_layout is defined %}{{ hosts_layout | to_nice_json }}{% else %}{% include 'host.j2' %}{% endif %},
  "instantiator" : {% include 'instantiator.j2' %}
}
